---
import { Image } from "astro:assets";
import Layout from "./Layout.astro";
import Copyright from "../components/Copyright.astro";
const { frontmatter } = Astro.props;
const mainImg = `../assets/${frontmatter.id}/${frontmatter.img}`;
const assets = import.meta.glob<{ default: ImageMetadata }>("../assets/**/*");

let videoSrc;
const loadVideo = async () => {
  videoSrc = videoAsset.default;
};
const videoAsset =
  await assets[`../assets/${frontmatter.id}/${frontmatter.video}`]();
await loadVideo();

// 説明文を生成（frontmatterにdescriptionがあればそれを使用、なければタイトルとカテゴリから生成）
const description =
  frontmatter.description ||
  `${frontmatter.title} - ${frontmatter.categories ? frontmatter.categories.join(", ") : frontmatter.category || ""} - YAAD.inc`;

const pageTitle = `${frontmatter.title} | YAAD.inc`;
---

<Layout title={pageTitle} description={description} ogType="article">
  <main
    class="pt-[16.8rem] px-[1.8rem] relative md:pt-[16.8rem] md:px-[2.4rem]"
  >
    <div class="grid grid-cols-1 sticky top-[100px] md:grid-cols-[47.5rem_1fr]">
      <div
        class="text-white font-neue text-[4rem] font-semibold leading-[100%] mb-16 md:text-[9.6rem] md:mb-24"
      >
        <a
          href={frontmatter.link}
          target="_blank"
          rel="noopener noreferrer"
          class={frontmatter.link
            ? "underline cursor-pointer"
            : "no-underline cursor-default"}
        >
          <h1>{frontmatter.title}</h1>
        </a>
      </div>
      <div
        class="font-neue font-normal grid grid-cols-[auto_1fr] gap-x-[5.2rem] gap-y-[1.2rem] h-fit md:row-[1/2] md:sticky md:top-[16.8rem]"
      >
        <h5 class="font-semibold">Release</h5>
        <p>{frontmatter.release}</p>
        <h5 class="font-semibold mb-8 md:mb-[7.2rem]">Category</h5>
        <p>
          {
            frontmatter.categories
              ? frontmatter.categories.join(", ")
              : frontmatter.category || ""
          }
        </p>
        <h5 class="font-semibold">Credit</h5>
        <div class="flex flex-col gap-[1.6rem] md:gap-[2.8rem]">
          {
            frontmatter.credits.map(({ name, value }: any) => {
              return (
                <div class="flex flex-col gap-[0.6rem] md:gap-[0.8rem]">
                  <p class="font-semibold">{name}</p>
                  <p>{value}</p>
                </div>
              );
            })
          }
        </div>
        <a
          class="hidden md:block text-white font-neue text-[3.2rem] font-semibold leading-[100%] underline col-span-2 my-40"
          href="/">Back To Page</a
        >
      </div>
      <div class="mb-[3.2rem] md:mb-0">
        <Image class="w-full h-auto" src={assets[mainImg]()} alt="main-image" />
        <div
          class="text-white text-[1.4rem] font-medium leading-[150%] tracking-[0.07rem] md:text-[2rem] [&_a]:underline [&_p]:text-white [&_p]:text-[1.4rem] [&_p]:font-medium [&_p]:leading-[150%] [&_p]:tracking-[0.07rem] md:[&_p]:text-[2rem]"
        >
          <slot />
        </div>
        {
          frontmatter.link && (
            <a
              href={frontmatter.link}
              target="_blank"
              rel="noopener noreferrer"
              class="rounded-[0.6rem] bg-white/10 backdrop-blur-[20px] no-underline flex items-center justify-between h-[6.4rem] w-[18rem] mt-[3.2rem] px-[2.4rem] text-white font-neue text-[1.6rem] font-semibold leading-[100%] md:mt-24 md:w-[24rem] md:h-[7.2rem] md:text-[2rem]"
            >
              <span>Official Link</span>
              <svg
                class="h-[1.4rem] w-[1.4rem] md:h-[1.8rem] md:w-[1.8rem]"
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M8 1H1V19H19V11M12.5 1H19V7.68571"
                  stroke="white"
                  stroke-width="2"
                />
                <path d="M19 1L7 13" stroke="white" stroke-width="2" />
              </svg>
            </a>
          )
        }
      </div>
    </div>
  </main>
  <footer
    class="mt-[5.6rem] text-right md:mt-56 px-[1.8rem] pb-[2.4rem] md:px-[2.4rem] md:pb-8"
  >
    <Copyright />
  </footer>
  <video
    class="fixed top-0 left-0 w-full h-full object-cover z-[-1]"
    style="opacity: 1;"
    src={videoSrc}
    autoplay
    loop
    muted
    playsinline></video>
</Layout>
